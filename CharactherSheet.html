<!DOCTYPE HTML>
<html>
	<head>
		<title>Charachter Sheet</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        .sheet-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .section {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .section-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #444;
        }
        .stat-row {
            display: flex;
            margin-bottom: 5px;
            align-items: center;
        }
        .stat-label {
            width: 50px;
            font-weight: bold;
        }
        .stat-input {
            width: 50px;
            padding: 5px;
            margin-right: 10px;
        }
        .modifier {
            width: 50px;
            background: #f0f0f0;
            border: none;
            padding: 5px;
            text-align: center;
        }
        textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
    </style>
	<body class="is-preload">
		<!-- Header -->
		<div id="header-placeholder"></div>
		<!-- Body-->
			<div class="sheet-container">
			<h1>TTRPG Character Sheet</h1>

			<div class="section">
				<div class="section-title">Character Info</div>
				<input type="text" placeholder="Character Name" id="charName">
				<input type="text" placeholder="Species" id="charSpecies">
				<input type="number" placeholder="Level" id="charLevel">
			</div>

			<div class="section">
				<div class="section-title">Stats</div>
				<div class="stat-row">
					<div class="stat-label">PHY</div>
					<input type="number" class="stat-input" id="str" min="-5" max="10">
				</div>
				<div class="stat-row">
					<div class="stat-label">DEX</div>
					<input type="number" class="stat-input" id="str" min="-5" max="10">
				</div>
				<div class="stat-row">
					<div class="stat-label">INT</div>
					<input type="number" class="stat-input" id="str" min="-5" max="10">
				</div>
				<div class="stat-row">
					<div class="stat-label">WIL</div>
					<input type="number" class="stat-input" id="str" min="-5" max="10">
				</div>
			</div>

			<div class="section">
				<div class="section-title">Arcane Feats</div>
				<textarea id="feats" placeholder="List your arcane feats here..."></textarea>
			</div>

			<div class="section">
				<div class="section-title">General Feats</div>
				<textarea id="feats" placeholder="List your general feats here..."></textarea>
			</div>

			<div class="section">
				<div class="section-title">Equipment</div>
				<textarea id="equipment" placeholder="List your equipment here..."></textarea>
			</div>

			<div class="section">
				<div class="section-title">Notes</div>
				<textarea id="notes" placeholder="Additional notes..."></textarea>
			</div>

			<button onclick="saveSheet()">Save Character</button>
			<button onclick="loadSheet()">Load Character</button>
			<button onclick="deleteSheet()">Delete Character</button>
			<div class="section">
				<div class="section-title">Load Character</div>
				<select id="characterList" onchange="populateCharacter()">
					<option value="">Select a character...</option>
				</select>
				<button onclick="loadSelectedCharacter()">Load Selected</button>
			</div>
			
			<div class="section">
				<div class="section-title">Export/Import</div>
				<button onclick="exportCharacter()">Export Character</button>
				<input type="file" id="importFile" accept=".json" onchange="importCharacter(event)" style="display: none;">
				<button onclick="document.getElementById('importFile').click()">Import Character</button>
			</div>

		</div>
		<!-- Footer -->
			<div id="footer">
				<!-- Copyright -->
					<ul class="copyright">
						<li>&copy; Edvin Skogsholm Sanne's Portfolio. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
			</div>
		<!-- Scripts -->
			<script>
				fetch('rpgheader.html')
					.then(response => response.text())
					.then(data => {
						document.getElementById('header-placeholder').innerHTML = data;
					});
				// Close dropdowns when clicking outside
				window.onclick = function(event) {
					if (!event.target.matches('.dropbtn')) {
						var dropdowns = document.getElementsByClassName("dropdown-content");
						for (var i = 0; i < dropdowns.length; i++) {
							var openDropdown = dropdowns[i];
							if (openDropdown.style.display === "block") {
								openDropdown.style.display = "none";
							}
						}
					}
				};
				// Update modifier when stat changes
				function updateModifier(statId, modId) {
					const statValue = parseInt(document.getElementById(statId).value) || 0;
					const modifier = calculateModifier(statValue);
					document.getElementById(modId).value = modifier >= 0 ? `+${modifier}` : modifier;
				}

				// Save character data to localStorage
				function saveSheet() {
					const charName = document.getElementById('charName').value;
					if (!charName) {
						alert('Please enter a character name.');
						return;
					}

					const charData = {
						name: charName,
						species: document.getElementById('charSpecies').value,
						level: document.getElementById('charLevel').value,
						stats: {
							phy: document.getElementById('phy').value,
							dex: document.getElementById('dex').value,
							int: document.getElementById('int').value,
							wil: document.getElementById('wil').value,
						},
						arcaneFeats: document.getElementById('arcaneFeats').value,
						generalFeats: document.getElementById('generalFeats').value,
						equipment: document.getElementById('equipment').value,
						notes: document.getElementById('notes').value,
					};

					// Get existing characters or initialize an empty array
					let characters = JSON.parse(localStorage.getItem('ttrpgCharacters')) || [];

					// Check if a character with this name already exists
					const existingIndex = characters.findIndex(char => char.name === charName);

					if (existingIndex >= 0) {
						// Update existing character
						characters[existingIndex] = charData;
					} else {
						// Add new character
						characters.push(charData);
					}

					// Save the updated array back to localStorage
					localStorage.setItem('ttrpgCharacters', JSON.stringify(characters));

					alert(`Character "${charName}" saved!`);
				}

				// Load character data from localStorage
				function loadSheet() {
					const charName = document.getElementById('charName').value;
					if (!charName) {
						alert('Please enter a character name to load.');
						return;
					}

					const characters = JSON.parse(localStorage.getItem('ttrpgCharacters')) || [];
					const charData = characters.find(char => char.name === charName);

					if (charData) {
						document.getElementById('charName').value = charData.name;
						document.getElementById('charSpecies').value = charData.species;
						document.getElementById('charLevel').value = charData.level;
						document.getElementById('phy').value = charData.stats.phy;
						document.getElementById('dex').value = charData.stats.dex;
						document.getElementById('int').value = charData.stats.int;
						document.getElementById('wil').value = charData.stats.wil;
						document.getElementById('arcaneFeats').value = charData.arcaneFeats;
						document.getElementById('generalFeats').value = charData.generalFeats;
						document.getElementById('equipment').value = charData.equipment;
						document.getElementById('notes').value = charData.notes;
						alert(`Character "${charName}" loaded!`);
					} else {
						alert(`No saved character found with the name "${charName}".`);
					}
				}

				// Delete a character
				function deleteSheet() {
					const charName = document.getElementById('charName').value;
					if (!charName) {
						alert('Please enter a character name to delete.');
						return;
					}

					let characters = JSON.parse(localStorage.getItem('ttrpgCharacters')) || [];
					const updatedCharacters = characters.filter(char => char.name !== charName);

					if (updatedCharacters.length === characters.length) {
						alert(`No saved character found with the name "${charName}".`);
					} else {
						localStorage.setItem('ttrpgCharacters', JSON.stringify(updatedCharacters));
						alert(`Character "${charName}" deleted!`);
					}
				}
				// Populate the character list dropdown
				function populateCharacterList() {
					const characterList = document.getElementById('characterList');
					characterList.innerHTML = '<option value="">Select a character...</option>';

					const characters = JSON.parse(localStorage.getItem('ttrpgCharacters')) || [];
					characters.forEach(char => {
						const option = document.createElement('option');
						option.value = char.name;
						option.textContent = char.name;
						characterList.appendChild(option);
					});
				}

				// Load the selected character from the dropdown
				function loadSelectedCharacter() {
					const characterList = document.getElementById('characterList');
					const charName = characterList.value;
					if (!charName) {
						alert('Please select a character to load.');
						return;
					}

					document.getElementById('charName').value = charName;
					loadSheet();
				}

				// Call this function when the page loads
				window.onload = function() {
					populateCharacterList();
				};

				// Export character as a JSON file
				function exportCharacter() {
					const charName = document.getElementById('charName').value;
					if (!charName) {
						alert('Please enter a character name to export.');
						return;
					}

					const characters = JSON.parse(localStorage.getItem('ttrpgCharacters')) || [];
					const charData = characters.find(char => char.name === charName);

					if (!charData) {
						alert(`No saved character found with the name "${charName}".`);
						return;
					}

					const jsonStr = JSON.stringify(charData, null, 2);
					const blob = new Blob([jsonStr], { type: 'application/json' });
					const url = URL.createObjectURL(blob);

					const a = document.createElement('a');
					a.href = url;
					a.download = `${charName}.json`;
					document.body.appendChild(a);
					a.click();
					document.body.removeChild(a);
					URL.revokeObjectURL(url);
				}

				// Import character from a JSON file
				function importCharacter(event) {
					const file = event.target.files[0];
					if (!file) return;

					const reader = new FileReader();
					reader.onload = function(e) {
						try {
							const charData = JSON.parse(e.target.result);

							// Get existing characters or initialize an empty array
							let characters = JSON.parse(localStorage.getItem('ttrpgCharacters')) || [];

							// Check if a character with this name already exists
							const existingIndex = characters.findIndex(char => char.name === charData.name);

							if (existingIndex >= 0) {
								// Update existing character
								characters[existingIndex] = charData;
							} else {
								// Add new character
								characters.push(charData);
							}

							// Save the updated array back to localStorage
							localStorage.setItem('ttrpgCharacters', JSON.stringify(characters));

							// Update the character list dropdown
							populateCharacterList();

							alert(`Character "${charData.name}" imported!`);
						} catch (error) {
							alert('Error importing character: ' + error.message);
						}
					};
					reader.readAsText(file);
				}


			</script>
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
	</body>
</html>